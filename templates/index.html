{% extends 'base.html' %}

{% block content %}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
<!-- Hero Section -->
<header class="hero-section text-white d-flex align-items-center" style="background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('{{ url_for('static', filename='images/hero-bg.png') }}') no-repeat center center; background-size: cover; min-height: 80vh;">
    <div class="container text-center">
        <div class="row justify-content-center">
            <div class="col-lg-10 col-xl-8">
                <h1 class="display-3 fw-bold mb-4">{{ _('Intelligent Wealth Growth. Simplified.') }}</h1>
                <p class="lead mb-5">{{ _('Secure automated investment plans for everyone, or dedicated managed accounts for elite capital. No trading experience required.') }}</p>
                <!-- Call to Action Buttons -->
                <div>
                    <a href="{{ url_for('main.plans') }}" class="btn btn-primary btn-lg mx-2 my-1 px-5 py-3 fw-semibold">{{ _('Start Growing (Plans)') }}</a>
                    <!-- Link redirects to plans section or signup -->
                    <a href="{{ url_for('main.marketplace') }}" class="btn btn-outline-light btn-lg mx-2 my-1 px-5 py-3 fw-semibold">{{ _('Explore VIP Solutions') }}</a>
                </div>
            </div>
        </div>
    </div>
</header>

<div class="market-ticker-section py-2 bg-black border-bottom border-secondary" style="overflow: hidden; white-space: nowrap; height: 40px;">
    <div class="container-fluid h-100 p-0">
        <div class="ticker-track d-flex align-items-center h-100" id="ticker-track">
            <span class="text-white-50 small ms-3">Loading market data...</span>
        </div>
    </div>
</div>

<!-- Investment Plans Section -->
<section class="py-5">
    <div class="container">
        <div class="row justify-content-center mb-5">
            <div class="col-lg-8 text-center">
                <h2 class="fw-bold">{{ _('Our Investment Plans') }}</h2>
                <p class="text-body-secondary" style="line-height: 1.6;">{{ _('Select a plan that matches your financial goals. Returns are annualized.') }}</p>
            </div>
        </div>

        <!-- Plans Slider -->
        <div class="swiper myPlanSwiper px-4 py-3">
            <div class="swiper-wrapper">
            {% set max_roi = plans|map(attribute='annual_return_rate')|max if plans else 0 %}
            {% for i in range(2) %}
            <!-- Loop through available investment plans -->
            {% for plan in plans %}
            {% set is_best = (plan.annual_return_rate == max_roi) %}
            <div class="swiper-slide h-auto">
                <div class="card plan-card h-100 rounded-4 shadow-sm bg-dark-subtle border-0 position-relative {{ 'best-plan-card' if is_best else '' }}">
                    
                    <!-- Risk Level Badge: Display a badge based on the plan's risk level -->
                    {% if plan.risk_level == 'low' %}
                        <div class="position-absolute top-0 end-0 m-3">
                            <span class="badge bg-success text-white fw-bold">{{ _('Low Risk') }}</span>
                        </div>
                    {% elif plan.risk_level == 'medium' %}
                        <div class="position-absolute top-0 end-0 m-3">
                            <span class="badge bg-warning-subtle text-warning-emphasis">{{ _('Medium Risk') }}</span>
                        </div>
                    {% else %}
                        <div class="position-absolute top-0 end-0 m-3">
                            <span class="badge bg-danger-subtle text-danger-emphasis">{{ _('High Risk') }}</span>
                        </div>
                    {% endif %}

                    <!-- Card Body with Plan Details -->
                    <div class="card-body p-4 d-flex flex-column">
                        <h3 class="fw-semibold">{{ plan.name }}</h3>
                        <p class="text-body-secondary mb-4" style="min-height: 48px;">{{ plan.description }}</p>
                        
                        <div class="mb-4">
                            <h1 class="fw-bold display-4 text-primary">{{ plan.annual_return_rate|int }}%</h1>
                            <h5 class="text-body-secondary">{{ _('Annual Return') }}</h5>
                            <h6 class="fw-normal text-white-50">{{ plan.duration_months }} {{ _('Months Duration') }}</h6>
                        </div>
                        
                        <div class="mt-auto">
                            <!-- Call to Action Button: Directs users to the signup page -->
                            <a href="{{ url_for('auth.signup') }}" class="btn {{ 'btn-highlight btn-lg' if is_best else 'btn-primary btn-lg' }} w-100">
                                {{ _('Choose Plan & Sign Up') }}
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Fallback message if no plans are available -->
            {% else %}
            <div class="col-12 text-center py-5">
                <h4 class="text-muted">{{ _('No investment plans available at the moment.') }}</h4>
            </div>
            {% endfor %}
            <div class="swiper-slide h-auto">
                <div class="card plan-card h-100 rounded-4 shadow-sm border-0 position-relative" style="background: linear-gradient(145deg, #0f0f0f, #2a2a2a); border: 1px solid #ffd700 !important;">
                    <div class="position-absolute top-0 end-0 m-3">
                        <span class="badge bg-warning text-dark fw-bold">{{ _('Min $100k') }}</span>
                    </div>
                    <div class="card-body p-4 d-flex flex-column">
                        <h3 class="fw-semibold text-warning"><i class="bi bi-gem me-2"></i>{{ _('VIP Managed') }}</h3>
                        <p class="text-white-50 mb-4" style="min-height: 48px;">{{ _('Exclusive strategy for high capital. Profit-sharing model based on performance.') }}</p>
                        <div class="mb-4">
                            <h1 class="fw-bold display-5 text-warning">{{ _('Profit Share') }}</h1>
                            <h5 class="text-secondary">{{ _('No Fixed Rate') }}</h5>
                            <h6 class="fw-normal text-white-50">{{ _('Flexible Duration') }}</h6>
                        </div>
                        <div class="mt-auto">
                            <button type="button" class="btn btn-outline-warning w-100 btn-lg fw-bold" data-bs-toggle="modal" data-bs-target="#vipModal">
                                {{ _('Request Access') }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
            </div>
            <div class="swiper-button-next" style="color: var(--bs-primary);"></div>
            <div class="swiper-button-prev" style="color: var(--bs-primary);"></div>
            <div class="swiper-pagination"></div>
        </div>

        <!-- Profit Calculator Widget (Moved Below) -->
        <div class="card mt-5 shadow-lg bg-dark-subtle border-0 profit-calculator">
            <div class="card-body p-4">
                <h3 class="fw-bold mb-4 text-center">{{ _('Profit Calculator') }}</h3>
                <div class="row g-4 align-items-center justify-content-center">
                    <div class="col-md-4">
                        <label for="plan-selector" class="form-label">{{ _('Select Plan') }}</label>
                        <select class="form-select form-select-lg" id="plan-selector">
                            <option value="" selected disabled>{{ _('Choose a plan...') }}</option>
                            {% for plan in all_plans %}
                            <option value="{{ plan.id }}" data-roi="{{ plan.annual_return_rate }}" data-duration="{{ plan.duration_months }}">
                                {{ plan.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="invest-amount" class="form-label mb-1">{{ _('Investment Amount ($)') }}</label>
                        <div class="d-flex align-items-center mb-2 bg-dark bg-opacity-50 rounded px-3 py-1 border border-secondary amount-wrapper">
                            <input type="number" class="form-control form-control-lg bg-transparent border-0 text-white fw-bold p-0" id="invest-amount" value="1000" min="100" max="1000000">
                        </div>
                        <input type="range" class="form-range" id="invest-range" min="100" max="1000000" step="500" value="1000">
                    </div>
                    <div class="col-md-5">
                        <div class="card bg-body-tertiary border-0 p-3">
                            <div class="d-flex justify-content-between mb-2 fs-5">
                                <span>{{ _('Total Return (Simple):') }}</span>
                                <span class="fw-bold text-white" id="total-return">$0.00</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2 fs-5">
                                <span>{{ _('Net Profit (Simple):') }}</span>
                                <span class="fw-bold text-success" id="net-profit">$0.00</span>
                            </div>
                            <div class="d-flex justify-content-between fs-5">
                                <span>{{ _('Potential with Compound Interest:') }} <i class="bi bi-info-circle small text-muted" title="{{ _('Assumes monthly reinvestment') }}" data-bs-toggle="tooltip"></i></span>
                                <span class="fw-bold text-success" id="compound-profit">$0.00</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- More Plans Button -->
        {% if plans %}
        <div class="row mt-5">
            <div class="col-12 text-center">
                <a href="{{ url_for('main.plans') }}" class="btn btn-outline-secondary btn-lg px-5 rounded-pill">
                    {{ _('View More Plans') }} <i class="bi bi-arrow-right ms-2"></i>
                </a>
            </div>
        </div>
        {% endif %}

    </div>
</section>

<!-- Solutions Section -->
<section class="py-5 bg-dark-subtle text-body-emphasis" id="solutions">
    <div class="container">
        <h2 class="text-center fw-bold mb-5">{{ _('Our Intelligent Solutions') }}</h2>
        <div class="row g-4 align-items-stretch">
            <!-- Card 1: Automated Growth Plans -->
            <div class="col-md-4">
                <div class="card h-100 p-4 rounded-4 shadow-sm border-primary border-2">
                    <div class="card-body text-center d-flex flex-column">
                        <div class="mb-3 text-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-graph-up-arrow" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M0 0h1v15h15v1H0V0Zm10 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V4.9l-3.613 4.417a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61L13.445 4H10.5a.5.5 0 0 1-.5-.5Z"/></svg>
                        </div>
                        <h3 class="card-title fw-bold mb-3">{{ _('Automated Growth Plans') }}</h3>
                        <p class="card-text mb-4">{{ _('Join our secure liquidity pools. Our AI trades, you receive passive profit based on your plan. Ideal for secure, hands-off growth.') }}</p>
                        <div class="mt-auto">
                            <a href="{{ url_for('main.plans') }}" class="btn btn-primary w-100">{{ _('View Plans & Calculate Profit') }}</a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Card 2: Private Managed Accounts (VIP) -->
            <div class="col-md-4">
                <div class="card h-100 p-4 rounded-4 shadow-sm border-0">
                    <div class="card-body text-center d-flex flex-column">
                        <div class="mb-3 text-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-briefcase-fill" viewBox="0 0 16 16"><path d="M6.5 1A1.5 1.5 0 0 0 5 2.5V3H1.5A1.5 1.5 0 0 0 0 4.5v1.384l7.614 2.03a1.5 1.5 0 0 0 .772 0L16 5.884V4.5A1.5 1.5 0 0 0 14.5 3H11v-.5A1.5 1.5 0 0 0 9.5 1h-3zm0 1h3a.5.5 0 0 1 .5.5V3H6v-.5a.5.5 0 0 1 .5-.5z"/><path d="M0 12.5A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5V6.85L8.129 8.947a.5.5 0 0 1-.258 0L0 6.85v5.65z"/></svg>
                        </div>
                        <h3 class="card-title fw-bold mb-3">{{ _('Private Managed Accounts (VIP)') }}</h3>
                        <p class="card-text mb-4">{{ _('For capital over $100k. Our AI trades directly in your NinjaTrader account. Full transparency, profit-share model.') }}</p>
                        <div class="mt-auto">
                            <a href="{{ url_for('main.contact_us') }}" class="btn btn-outline-primary w-100">{{ _('Request Consultation') }}</a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Card 3: Developer API & Lab (Coming Soon) -->
            <div class="col-md-4">
                <div class="card h-100 p-4 rounded-4 shadow-sm border-0 position-relative opacity-75">
                    <div class="position-absolute top-0 end-0 m-3">
                        <span class="badge bg-secondary">{{ _('COMING SOON') }}</span>
                    </div>
                    <div class="card-body text-center d-flex flex-column">
                        <div class="mb-3 text-secondary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-code-slash" viewBox="0 0 16 16"><path d="M10.478 1.647a.5.5 0 1 0-.956-.294l-4 13a.5.5 0 0 0 .956.294l4-13zM4.854 4.146a.5.5 0 0 1 0 .708L1.707 8l3.147 3.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3.5-3.5a.5.5 0 0 1 .708 0zm6.292 0a.5.5 0 0 0 0 .708L14.293 8l-3.147 3.146a.5.5 0 0 0 .708.708l3.5-3.5a.5.5 0 0 0 0-.708l-3.5-3.5a.5.5 0 0 0-.708 0z"/></svg>
                        </div>
                        <h3 class="card-title fw-bold mb-3">{{ _('Developer API & Lab') }}</h3>
                        <p class="card-text mb-4">{{ _('Access our low-latency infrastructure and historical data to build your own tools.') }}</p>
                        <div class="mt-auto">
                            <button class="btn btn-secondary w-100" disabled>{{ _('Join Waitlist') }}</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- How It Works Section -->
<section class="py-5 bg-light text-dark">
    <div class="container">
        <h2 class="text-center fw-bold mb-5">{{ _('Simple, Secure Growth. How it Works.') }}</h2>
        
        <!-- Video Area -->
        <div class="row justify-content-center mb-5">
            <div class="col-lg-8">
                <div class="ratio ratio-16x9 bg-dark rounded-4 shadow-sm overflow-hidden">
                    <video controls poster="{{ url_for('static', filename='images/logo.png') }}">
                        {% if get_locale() == 'fa' %}
                        <source src="{{ url_for('static', filename='videos/vesthub-fa.mp4') }}" type="video/mp4">
                        {% elif get_locale() == 'tr' %}
                        <source src="{{ url_for('static', filename='videos/vesthub-tr.mp4') }}" type="video/mp4">
                        {% else %}
                        <source src="{{ url_for('static', filename='videos/vesthub-en.mp4') }}" type="video/mp4">
                        {% endif %}
                        {{ _('Your browser does not support the video tag.') }}
                    </video>
                </div>
                <p class="text-center mt-3 fw-bold fs-5">{{ _('WATCH EXPLAINER VIDEO: How VestHub Grows Your Wealth Safely') }}</p>
            </div>
        </div>

        <!-- Steps Row -->
        <div class="row g-4 text-center">
            <div class="col-md-4">
                <div class="p-3">
                    <i class="bi bi-wallet2 fs-1 text-primary mb-3"></i>
                    <h4 class="fw-bold">{{ _('Select Plan & Deposit') }}</h4>
                </div>
            </div>
            <div class="col-md-4">
                <div class="p-3">
                    <i class="bi bi-gear-wide-connected fs-1 text-primary mb-3"></i>
                    <h4 class="fw-bold">{{ _('AI Manages & Trades') }}</h4>
                </div>
            </div>
            <div class="col-md-4">
                <div class="p-3">
                    <i class="bi bi-cash-coin fs-1 text-primary mb-3"></i>
                    <h4 class="fw-bold">{{ _('Withdraw Your Profits') }}</h4>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Performance/Features Section -->
<section class="performance-section py-5">
    <div class="container">
        <h2 class="text-center fw-bold mb-5">{{ _('A Platform Built for Performance') }}</h2>
        <!-- Features Grid -->
        <div class="row g-4">
            <div class="col-md-6 col-lg-3">
                <div class="text-center">
                    <i class="bi bi-shield-lock feature-icon fs-1 text-primary mb-3"></i>
                    <h5 class="fw-semibold">{{ _('Institutional-Grade Security') }}</h5>
                    <p class="text-secondary" style="line-height: 1.6;">{{ _('Bank-level encryption & cold storage.') }}</p>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="text-center">
                    <i class="bi bi-patch-check feature-icon fs-1 text-primary mb-3"></i>
                    <h5 class="fw-semibold">{{ _('Fully Managed Risk') }}</h5>
                    <p class="text-secondary" style="line-height: 1.6;">{{ _('AI-Driven Risk Management.') }}</p>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="text-center">
                    <i class="bi bi-bar-chart feature-icon fs-1 text-primary mb-3"></i>
                    <h5 class="fw-semibold">{{ _('Real-Time Transparency') }}</h5>
                    <p class="text-secondary" style="line-height: 1.6;">{{ _('Real-time performance dashboards.') }}</p>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="text-center">
                    <i class="bi bi-code-square feature-icon fs-1 text-primary mb-3"></i>
                    <h5 class="fw-semibold">{{ _('Future-Ready Infrastructure') }}</h5>
                    <p class="text-secondary" style="line-height: 1.6;">{{ _('API Coming Soon.') }}</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Final Call to Action Section -->
<section class="py-5 bg-primary text-white text-center">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                    <h2 class="fw-bold mb-4">{{ _('Join the Future of Automated Trading.') }}</h2>
                <p class="lead mb-4">{{ _('Sign up for free and get access to your new trading dashboard.') }}</p>
                <a href="{{ url_for('auth.signup') }}" class="btn btn-light btn-lg fw-bold px-5">{{ _('Sign Up Free') }}</a>
            </div>
        </div>
    </div>
</section>

<div class="modal fade" id="vipModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark text-white border border-secondary">
            <div class="modal-header border-bottom border-secondary">
                <h5 class="modal-title fw-bold text-warning">
                    <i class="bi bi-crown me-2"></i>{{ _('VIP Exclusive Access') }}
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center py-4">
                <i class="bi bi-shield-lock-fill text-warning display-1 mb-3"></i>
                <p class="lead mb-4">{{ _('VIP accounts require a minimum deposit of $100,000.') }}</p>
                <p class="text-white-50">{{ _('This involves a dedicated account manager and a profit-sharing model (not fixed ROI). Please contact support to proceed.') }}</p>
            </div>
            <div class="modal-footer border-top border-secondary justify-content-center">
                <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">{{ _('Close') }}</button>
                <a href="{{ url_for('main.contact_us') }}" class="btn btn-warning fw-bold px-4">{{ _('Contact Support') }}</a>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
          return new bootstrap.Tooltip(tooltipTriggerEl)
        })

        const amountInput = document.getElementById('invest-amount');
        const amountRange = document.getElementById('invest-range');
        const planSelect = document.getElementById('plan-selector');
        const totalReturnEl = document.getElementById('total-return');
        const netProfitEl = document.getElementById('net-profit');
        const compoundProfitEl = document.getElementById('compound-profit');

        function calculate() {
            const selectedOption = planSelect.options[planSelect.selectedIndex];
            
            // Check if a valid plan is selected (has data attributes)
            if (!selectedOption || !selectedOption.dataset.roi) {
                totalReturnEl.textContent = '$0.00';
                netProfitEl.textContent = '$0.00';
                compoundProfitEl.textContent = '$0.00';
                return;
            }

            const roi = parseFloat(selectedOption.dataset.roi); // Annual Rate %
            const durationMonths = parseFloat(selectedOption.dataset.duration);
            const amount = parseFloat(amountInput.value) || 0;

            // Variables for formula
            const P = amount;
            const r = roi / 100;
            const n = 12; // Monthly compounding
            const t = durationMonths / 12; // Time in years

            // 1. Simple Profit: P * r * t
            const simpleProfit = P * r * t;
            const simpleTotal = P + simpleProfit;

            // 2. Compound Amount: A = P * (1 + r/n)^(n*t)
            const compoundAmount = P * Math.pow((1 + (r / n)), (n * t));
            const compoundProfit = compoundAmount - P;

            // Formatting
            const formatter = new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2
            });

            totalReturnEl.textContent = formatter.format(simpleTotal);
            netProfitEl.textContent = formatter.format(simpleProfit);
            compoundProfitEl.textContent = formatter.format(compoundProfit);
        }

        planSelect.addEventListener('change', calculate);
        
        // Sync Range Slider -> Number Input & Calculate
        amountRange.addEventListener('input', function() {
            amountInput.value = this.value;
            calculate();
        });

        // Sync Number Input -> Range Slider & Calculate
        amountInput.addEventListener('input', function() {
            amountRange.value = this.value;
            calculate();
        });
    });
</script>

{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // 1. Find the index of the FIRST highlighted plan (best plan)
        // Since we duplicated the list in HTML, we just need the first occurrence.
        let initialIndex = 0;
        const slides = document.querySelectorAll('.swiper-slide');
        
        for (let i = 0; i < slides.length; i++) {
            // Look for the card inside the slide that has the 'best-plan-card' class
            if (slides[i].querySelector('.best-plan-card')) {
                initialIndex = i;
                break; 
            }
        }

        // Check for RTL direction
        const isRtl = document.documentElement.getAttribute('dir') === 'rtl';

        // 2. Initialize Swiper with True Loop settings
        var swiper = new Swiper(".myPlanSwiper", {
            slidesPerView: 1,
            spaceBetween: 30,
            rtl: isRtl,
            // Loop Settings
            loop: true,
            loopedSlides: 4,          // CRITICAL: Tells Swiper how many slides to clone for smooth edges
            
            centeredSlides: true,     // Center the active slide
            initialSlide: initialIndex, // Start focused on the best plan
            
            slideToClickedSlide: true,
            observer: true,
            observeParents: true,
            grabCursor: true,
            
            pagination: {
                el: ".swiper-pagination",
                clickable: true,
            },
            navigation: {
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev",
            },
            breakpoints: {
                640: { slidesPerView: 1 },
                768: { slidesPerView: 2 },
                1024: { slidesPerView: 3 }, 
            },
        });
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const track = document.getElementById('ticker-track');
        
        function fetchMarketData() {
            fetch('/api/market-data')
                .then(response => response.json())
                .then(data => {
                    if(!data || data.length === 0) return;
                    
                    let htmlContent = '';
                    data.forEach(item => {
                        const colorClass = item.change >= 0 ? 'text-success' : 'text-danger';
                        const arrow = item.change >= 0 ? '▲' : '▼';
                        htmlContent += `
                            <div class="d-inline-block px-4 border-end border-secondary border-opacity-25">
                                <span class="fw-bold text-white small me-2">${item.name}</span>
                                <span class="text-white small me-2">$${item.price}</span>
                                <span class="${colorClass} small fw-bold">${arrow} ${Math.abs(item.percent_change)}%</span>
                            </div>
                        `;
                    });

                    // Duplicate content to ensure smooth scrolling
                    track.innerHTML = htmlContent + htmlContent + htmlContent + htmlContent;
                })
                .catch(err => console.error('Error loading market data:', err));
        }

        // Initial Load
        fetchMarketData();
        // Refresh every 60 seconds
        setInterval(fetchMarketData, 60000);
    });
</script>
{% endblock %}